          ┌─────────────┐
          │ 订单服务     │
          └───┬─────────┘
              │ 1. 本地事务：写订单 + 写 local_message
              │ 2. 提交事务
              │ 3. 发送「扣减库存」→ MQ
              ▼
          ┌─────────────┐
          │    MQ       │
          └───┬─────────┘
              ▼
          ┌─────────────┐
          │ 库存服务     │
          └───┬─────────┘
              │ 4. 扣减库存
              │ 5. 成功/失败后调用订单服务回调
              ▼
          ┌─────────────┐
          │ 订单服务     │
          └───┬─────────┘
              │ 6. 收到回调 → 更新 status=3/4
              │    （幂等处理）
              │
              │ 7. 对账任务兜底

---


| 状态码 | 名称   | 说明                             | 进入条件                     |
|--------|--------|----------------------------------|------------------------------|
| 0      | 待支付 | 订单创建成功，等待用户支付       | createOrder()                |
| 1      | 支付中 | 用户发起支付，等待第三方回调     | 支付请求发出                 |
| 2      | 已支付 | 支付成功，进入履约流程           | 收到支付成功回调             |
| 3      | 已发货 | 仓库已发货                       | warehouseService.deliver()   |
| 4      | 已完成 | 用户确认收货或自动完成           | confirmReceipt() 或 超时自动完成 |
| 5      | 已取消 | 用户主动取消（未支付前）         | cancelOrder()                |
| 6      | 已关闭 | 支付失败、库存不足、超时未支付等 | closeOrder()                 |


